apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "cloud-native-app.labels" . | nindent 4 }}
data:
  POSTGRES_DB: {{ .Values.database.config.name | quote }}
  POSTGRES_USER: {{ .Values.database.config.user | quote }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-script
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "cloud-native-app.labels" . | nindent 4 }}
data:
  init.sql: |
    CREATE TABLE IF NOT EXISTS items (
      id          SERIAL PRIMARY KEY,
      name        VARCHAR(255) NOT NULL,
      description TEXT,
      created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    INSERT INTO items (name, description) VALUES
      ('Docker',       'Container runtime for packaging and running applications'),
      ('Kubernetes',   'Container orchestration platform for scaling and managing containers'),
      ('Cloud Native', 'Approach to building and running apps in cloud environments')
    ON CONFLICT DO NOTHING;
